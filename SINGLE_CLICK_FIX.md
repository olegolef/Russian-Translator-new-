# Исправление одиночного клика для перевода

## Проблема
После добавления выделения слов из словаря оранжевым цветом перестал работать обычный перевод при однократном клике.

## Причина
1. **Устаревший алгоритм определения слова** - использовался старый метод расчета позиции
2. **Отсутствие обработчика onClick** - для текста с выделениями не передавался обработчик клика
3. **Конфликт с новым выделением** - алгоритм не учитывал HTML-разметку с выделениями

## Исправления

### 1. Обновлен алгоритм определения слова
**Было:**
```javascript
const wordWidth = word.length * 8; // Фиксированная ширина
if (currentX <= clickX && clickX <= currentX + wordWidth) {
```

**Стало:**
```javascript
const averageCharWidth = formattingOptions.fontSize * 0.6; // Динамическая ширина
const clickedCharIndex = Math.floor(clickX / averageCharWidth);
if (currentCharIndex <= clickedCharIndex && clickedCharIndex <= currentCharIndex + wordLength) {
```

### 2. Добавлен обработчик onClick
**Было:**
```javascript
<div
  dangerouslySetInnerHTML={{ __html: highlightedText }}
  onDoubleClick={handleDoubleClick}
  // onClick отсутствовал
/>
```

**Стало:**
```javascript
<div
  dangerouslySetInnerHTML={{ __html: highlightedText }}
  onClick={handleWordClick}
  onDoubleClick={handleDoubleClick}
/>
```

### 3. Добавлены отладочные логи
- Логирование процесса одиночного клика
- Информация о найденном слове
- Отслеживание процесса перевода

## Как тестировать

### Шаг 1: Добавьте слова в словарь
1. Откройте любую книгу
2. Дважды кликните на несколько слов
3. Убедитесь, что они выделились оранжевым

### Шаг 2: Протестируйте одиночный клик
1. Найдите слово, которое НЕ в словаре (не оранжевое)
2. Один раз кликните на него
3. В консоли должны появиться логи:
   ```
   === ОДИНОЧНЫЙ КЛИК ОБРАБОТАН ===
   Выделенный текст: 
   Текст элемента: [текст абзаца]
   Позиция клика X: [число]
   Найденное слово: hello
   Очищенное слово: hello
   Получен перевод: {meanings: [...], transcription: "..."}
   ```

### Шаг 3: Проверьте результат
1. Слово должно выделиться синим цветом
2. Должен появиться тултип с переводом
3. Перевод должен отображаться в левой панели

### Шаг 4: Протестируйте с выделенными словами
1. Найдите слово, которое в словаре (оранжевое)
2. Один раз кликните на него
3. Должен появиться перевод (синее выделение поверх оранжевого)

### Шаг 5: Проверьте двойной клик
1. Дважды кликните на любое слово
2. Оно должно добавиться в словарь
3. Появиться оранжевое выделение

## Отладочная информация

### В консоли браузера:
- Логи одиночного клика
- Информация о найденном слове
- Процесс получения перевода
- Ошибки (если есть)

### Проверьте:
1. **Консоль браузера** - есть ли логи при одиночном клике?
2. **Выделение слова** - выделяется ли слово синим?
3. **Тултип перевода** - появляется ли перевод?
4. **Левая панель** - отображается ли перевод?

## Возможные проблемы

### Слово не определяется
- Проверьте логи в консоли
- Убедитесь, что клик происходит по тексту
- Проверьте размер шрифта в настройках

### Перевод не загружается
- Проверьте подключение к интернету
- Проверьте настройки API переводчика
- Посмотрите ошибки в консоли

### Конфликт с выделениями
- Убедитесь, что одиночный клик работает на обычных словах
- Проверьте, что двойной клик работает на любых словах
- Проверьте приоритеты отображения (синий > оранжевый)

## Приоритеты отображения

1. **Синий** - выделение при одиночном клике (перевод)
2. **Оранжевый** - слова из словаря
3. **Различные цвета** - комментарии пользователя
